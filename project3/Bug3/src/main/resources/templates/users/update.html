<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	layout:decorate="~{fragments/layout}">
<body>

	<div layout:fragment="content">
		<h2 class="mb-4">íšŒì›ì •ë³´ ìˆ˜ì •</h2>

		<!-- ë©”ì‹œì§€ -->
		<div th:if="${errorMessage}" class="alert alert-danger"
			th:text="${errorMessage}"></div>
		<div th:if="${successMessage}" class="alert alert-success"
			th:text="${successMessage}"></div>

		<div sec:authorize="isAuthenticated()">
			<form th:action="@{/users/update}" method="post"
				enctype="multipart/form-data">

				<!-- âœ… CSRF -->
				<input type="hidden" th:name="${_csrf.parameterName}"
					th:value="${_csrf.token}" />

				<!-- ğŸ” ë¡œì»¬ íšŒì›ë§Œ ë¹„ë°€ë²ˆí˜¸ -->
				<div class="mb-3" th:if="${dto.provider == 'local'}">
					<label class="form-label">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label> <input type="password"
						name="password" class="form-control" required>
				</div>

				<div class="mb-3">
					<label class="form-label">ë‹‰ë„¤ì„</label> <input type="text"
						name="nickname" class="form-control" th:value="${dto.nickname}">
				</div>

				<div class="mb-3">
					<label class="form-label">íœ´ëŒ€í°</label> <input type="text"
						name="mobile" class="form-control" th:value="${dto.mobile}">
				</div>

				<!-- ğŸ“® ì£¼ì†Œ -->
				<div class="mb-3">
					<label class="form-label">ìš°í¸ë²ˆí˜¸</label>
					<div class="input-group">
						<input type="text" id="postcode" name="postcode"
							class="form-control" th:value="${dto.postcode}">
						<button type="button" class="btn btn-outline-secondary"
							onclick="execDaumPostcode()">ê²€ìƒ‰</button>
					</div>
				</div>

				<div class="mb-3">
					<label class="form-label">ì£¼ì†Œ</label> <input type="text"
						id="address" name="address" class="form-control"
						th:value="${dto.address}">
				</div>

				<div class="mb-3">
					<label class="form-label">ìƒì„¸ì£¼ì†Œ</label> <input type="text"
						id="detailAddress" name="detailAddress" class="form-control"
						th:value="${dto.detailAddress}">
				</div>

				<!-- ğŸ–¼ í”„ë¡œí•„ -->
				<div class="mb-3">
					<label class="form-label">í”„ë¡œí•„ ì´ë¯¸ì§€</label> <input type="file"
						name="file" class="form-control">
					<div class="mt-2" th:if="${dto.ufile != null}">
						<img th:src="@{|/upload/${dto.ufile}|}" style="max-width: 120px">
					</div>
				</div>

				<button type="submit" class="btn btn-primary">ìˆ˜ì •í•˜ê¸°</button>
			</form>
		</div>
	</div>

	<!-- ğŸ“Œ ì£¼ì†Œ API -->
	<script
		src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
	<script>
		function execDaumPostcode() {
			new daum.Postcode({
				oncomplete : function(data) {
					document.getElementById('postcode').value = data.zonecode;
					document.getElementById('address').value = data.roadAddress
							|| data.jibunAddress;
					document.getElementById('detailAddress').focus();
				}
			}).open();
		}
	</script>

</body>
</html>
