<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	layout:decorate="~{fragments/layout}">
<body>
	<div layout:fragment="content">
		<div class="container my-5">
			
			<div class="d-flex justify-content-between align-items-center mb-3">
				<h2 class="mb-0" style="font-weight: bold; color: #333;">
					재료 목록 <span class="text-muted" style="font-size: 0.6em;">(관리자)</span>
				</h2>
				<div sec:authorize="hasRole('ROLE_ADMIN')">
					<a th:href="@{/material/materialinsert}" class="btn btn-primary shadow-sm" style="font-weight: bold;">
						재료 추가하기
					</a>
				</div>
			</div>

			<div class="mb-4">
				<form th:action="@{/material/materiallist}" method="get" class="input-group shadow-sm">
					<input type="text" name="keyword" th:value="${keyword}"
						class="form-control form-control-lg" 
						placeholder="찾으시는 재료 이름이나 카테고리를 입력하세요..." 
						style="border-color: #dee2e6;">
					<button class="btn btn-dark px-4" type="submit">
						검색하기
					</button>
				</form>
			</div>

			<div class="table-responsive">
				<table class="table table-striped table-bordered table-hover">
					<thead class="table-light text-center">
						<tr>
							<th style="width: 5%;">번호</th>
							<th style="width: 10%;">이미지</th>
							<th style="width: 20%;">이름</th>
							<th style="width: 10%;">카테고리</th>
							<th style="width: 10%;">계절</th>
							<th style="width: 10%;">온도</th>
							<th style="width: 10%;">칼로리</th>
							<th style="width: 15%;">등록일</th>
							<th style="width: 10%;">관리</th>
						</tr>
					</thead>
					
					<tbody class="text-center align-middle">
						<tr th:each="dto, vs : ${list}">
							<td th:text="${vs.count}">1</td>
							<td>
								<img th:src="@{/upload/{img}(img=${dto.imageurl})}"
									 style="width: 60px; height: 45px; object-fit: cover; border-radius: 4px;" 
									 onerror="this.src='/upload/defult.png';" />
							</td>
							<td>
								<a th:href="@{/material/materialdetail(materialid=${dto.materialid})}"
								   th:text="${dto.title}" class="fw-bold text-decoration-none text-dark">이름</a>
							</td>
							<td>
								<span class="badge bg-secondary" th:text="${dto.category}">분류</span>
							</td>
							<td th:text="${dto.season}">계절</td>
							<td th:text="${dto.temperature}">온도</td>
							<td th:text="${dto.calories100g}">칼로리</td>
							<td th:text="${dto.created_at != null ? #strings.replace(dto.created_at, 'T', ' ') : '-'}">생성일</td>
							<td>
								<div sec:authorize="isAuthenticated()">
									<span th:if="${#authorization.expression('hasRole(''ROLE_ADMIN'')') or dto.writer == #authentication.name}">
										<a th:href="@{/material/materialedit(materialid=${dto.materialid})}"
										   class="btn btn-sm btn-outline-warning">수정</a>
										<a th:href="@{/material/materialdelete(materialid=${dto.materialid})}"
										   class="btn btn-sm btn-outline-danger"
										   onclick="return confirm('삭제할까요?');">삭제</a>
									</span>
								</div>
							</td>
						</tr>
						<tr th:if="${#lists.isEmpty(list)}">
							<td colspan="9" class="py-5 text-muted text-center">
								데이터가 존재하지 않습니다.
							</td>
						</tr>
					</tbody>

					<tfoot>
						<tr>
							<td colspan="9">
								<ul class="pagination justify-content-center mb-0 py-2">
									<li class="page-item" th:if="${paging.start > 10}">
										<a class="page-link" 
										   th:href="@{/material/materiallist(pstartno=${paging.start-1}, keyword=${keyword})}">이전</a>
									</li>

									<li class="page-item" th:each="i : ${#numbers.sequence(paging.start, paging.end)}"
										th:classappend="${i == paging.current} ? 'active'">
										<a class="page-link" 
										   th:href="@{/material/materiallist(pstartno=${i}, keyword=${keyword})}"
										   th:text="${i}">1</a>
									</li>

									<li class="page-item" th:if="${paging.pagetotal > paging.end}">
										<a class="page-link" 
										   th:href="@{/material/materiallist(pstartno=${paging.end+1}, keyword=${keyword})}">다음</a>
									</li>
								</ul>
							</td>
						</tr>
					</tfoot>
				</table>
			</div>
		</div>
	</div>
</body>
</html>