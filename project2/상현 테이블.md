â–  ìš”ë¦¬íŒŒíŠ¸
> TODO1. SQL      
> TODL2. í”¼ê·¸ë§ˆ ì‘ì„±


# ğŸ§© 1. **USER í…Œì´ë¸” (BUG)** â€” ìµœì‹  ë²„ì „

```sql
CREATE TABLE BUG (
    APPUSERID   NUMBER          PRIMARY KEY,         
    PASSWORD    VARCHAR2(100)   NOT NULL,           
    NICKNAME    VARCHAR2(50)    UNIQUE,              
    EMAIL       VARCHAR2(100)   UNIQUE,              
    MOBILE      VARCHAR2(20)    UNIQUE,              
    BFILE       VARCHAR2(225),                      
    JOINDATE    DATE DEFAULT SYSDATE                
);
```

### âœ” ì˜ˆì‹œ ë°ì´í„°

```sql
INSERT INTO BUG (APPUSERID, PASSWORD, NICKNAME, EMAIL, MOBILE, BFILE)
VALUES (1, '1234', 'í™ê¸¸ë™', 'hong@test.com', '010-1234-5678', 'profile1.png');
```

---

# ğŸ§© 2. **CATEGORY í…Œì´ë¸”**

```sql
CREATE TABLE CATEGORY (
   CATEGORY      NUMBER PRIMARY KEY,
   CATEGORY_NAME VARCHAR2(100)
);
```

### âœ” ì˜ˆì‹œ ë°ì´í„°

```sql
INSERT INTO CATEGORY VALUES (1, 'ì „ì²´');
INSERT INTO CATEGORY VALUES (2, 'í•œì‹');
INSERT INTO CATEGORY VALUES (3, 'ì–‘ì‹');
INSERT INTO CATEGORY VALUES (4, 'ì¤‘ì‹');
INSERT INTO CATEGORY VALUES (5, 'ì¼ì‹');
INSERT INTO CATEGORY VALUES (6, 'ë””ì €íŠ¸');
INSERT INTO CATEGORY VALUES (7, 'ê±´ê°•ì‹');
INSERT INTO CATEGORY VALUES (8, 'ê¸°íƒ€');
```

---

# ğŸ§© 3. **RECIPES (ë ˆì‹œí”¼ ë³¸ë¬¸ í…Œì´ë¸”)**

USER í…Œì´ë¸”ì´ **BUG**ì´ë¯€ë¡œ FKëŠ” BUG.APPUSERIDë¥¼ ì°¸ì¡°í•´ì•¼ í•¨.

```sql
CREATE TABLE recipes (
    RECIPE_ID   NUMBER PRIMARY KEY,
    APPUSERID   NUMBER NOT NULL,
    TITLE       VARCHAR2(255) NOT NULL,
    CATEGORY    NUMBER, 
    IMAGE       VARCHAR2(255) DEFAULT 'user.png',
    COOK_TIME   NUMBER DEFAULT 0,
    DIFFICULTY  VARCHAR2(50),
    SERVINGS    NUMBER DEFAULT 1,
    DESCRIPTION VARCHAR2(4000),
    INSTRUCTIONS VARCHAR2(4000),
    CREATED_AT  TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UPDATED_AT  TIMESTAMP,
    VIEWS       NUMBER DEFAULT 0,

    FOREIGN KEY (APPUSERID) REFERENCES BUG(APPUSERID),
    FOREIGN KEY (CATEGORY)  REFERENCES CATEGORY(CATEGORY)
);
```

### âœ” ì˜ˆì‹œ ë°ì´í„°

```sql
INSERT INTO recipes (
    RECIPE_ID, APPUSERID, TITLE, CATEGORY, IMAGE, 
    COOK_TIME, DIFFICULTY, SERVINGS, DESCRIPTION, INSTRUCTIONS
) VALUES (
    1,
    1,
    'ë¹„ë¹”ë°¥',
    2,
    'main_bibimbap.jpg',
    10,
    'ì‰¬ì›€',
    2,
    'í•œêµ­ ì „í†µ ëŒ€í‘œ ìŒì‹ì…ë‹ˆë‹¤.',
    '1. ì¬ë£Œ ì¤€ë¹„\n2. ë¹„ë¹„ê¸°\n3. ë§›ìˆê²Œ ë¨¹ê¸°'
);
```

---

# ğŸ§© 4. **ë ˆì‹œí”¼ ë‹¤ì¤‘ ì´ë¯¸ì§€ í…Œì´ë¸”**

```sql
CREATE TABLE recipes_img (
    RECIPE_ID NUMBER,
    RURL      VARCHAR2(250),
    FOREIGN KEY (RECIPE_ID) REFERENCES recipes(RECIPE_ID)
);
```

âš  *ë„ˆê°€ INSERT ì˜ˆì‹œì—ì„œ í•„ë“œëª…ì´ IURLë¡œ ë˜ì–´ ìˆì—ˆëŠ”ë° CREATEì—ì„œëŠ” RURLì´ë¼ ì´ë¦„ì„ í†µì¼í•´ ì¤¬ì–´.*

### âœ” ì˜ˆì‹œ ë°ì´í„°

```sql
INSERT INTO recipes_img (RECIPE_ID, RURL) VALUES (1, 'bibim_01.png');
INSERT INTO recipes_img (RECIPE_ID, RURL) VALUES (1, 'bibim_02.png');
INSERT INTO recipes_img (RECIPE_ID, RURL) VALUES (1, 'bibim_03.png');
```

---

# ğŸ§© 5. **ì¬ë£Œ í…Œì´ë¸” êµ¬ì¡°**

## 5-1. ì¬ë£Œ ë§¤í•‘ í…Œì´ë¸” (ë ˆì‹œí”¼ í•˜ë‚˜ë‹¹ ì¬ë£Œ ê·¸ë£¹ 1ê°œ)

```sql
CREATE TABLE recipes_ingre_map (
    RECIPE_ID    NUMBER,
    INGRE_MAP_ID NUMBER PRIMARY KEY,
    FOREIGN KEY (RECIPE_ID) REFERENCES recipes(RECIPE_ID)
);
```

### âœ” ì˜ˆì‹œ

```sql
INSERT INTO recipes_ingre_map (RECIPE_ID, INGRE_MAP_ID)
VALUES (1, 100);
```

---

## 5-2. ì¬ë£Œ ìƒì„¸ í…Œì´ë¸”

```sql
CREATE TABLE recipes_ingre (
    INGRE_MAP_ID NUMBER,
    INGRE_NAME   VARCHAR2(100),
    INGRE_NUM    VARCHAR2(50),

    FOREIGN KEY (INGRE_MAP_ID) REFERENCES recipes_ingre_map(INGRE_MAP_ID)
);
```

âœ” ì˜ˆì‹œ

```sql
INSERT INTO recipes_ingre VALUES (100, 'ì–‘íŒŒ', '1ê°œ');
INSERT INTO recipes_ingre VALUES (100, 'ê³„ë€', '2ê°œ');
INSERT INTO recipes_ingre VALUES (100, 'ê³ ì¶”ì¥', '1ìŠ¤í‘¼');
```

---

# ğŸ§© 6. CRUD SQL â€” âœ”ì™„ì„±ë³¸

---

# ğŸ“Œ **CREATE**

## âœ” ë ˆì‹œí”¼ ID ìƒì„±

```sql
SELECT NVL(MAX(RECIPE_ID), 0) + 1 AS NEW_ID FROM recipes;
```

## âœ” ë ˆì‹œí”¼ ë“±ë¡

```sql
INSERT INTO recipes (
    RECIPE_ID, APPUSERID, TITLE, CATEGORY, IMAGE,
    COOK_TIME, DIFFICULTY, SERVINGS, DESCRIPTION, INSTRUCTIONS
) VALUES (
    :recipe_id, :appuserid, :title, :category,
    NVL(:image, 'user.png'),
    :cook_time, :difficulty, :servings,
    :description, :instructions
);
```

## âœ” ì´ë¯¸ì§€ ë“±ë¡

```sql
INSERT INTO recipes_img (RECIPE_ID, RURL) VALUES (:recipe_id, :rurl);
```

## âœ” ì¬ë£Œ ì €ì¥

```sql
INSERT INTO recipes_ingre_map (RECIPE_ID, INGRE_MAP_ID)
VALUES (:recipe_id, :ingre_map_id);

INSERT INTO recipes_ingre (INGRE_MAP_ID, INGRE_NAME, INGRE_NUM)
VALUES (:ingre_map_id, :name, :num);
```

---

# ğŸ“Œ **READ**

## âœ” 1) ë ˆì‹œí”¼ + ìœ ì € JOIN ì¡°íšŒ

```sql
SELECT 
    R.*,
    U.NICKNAME,
    U.BFILE AS USER_IMAGE
FROM recipes R
JOIN BUG U ON R.APPUSERID = U.APPUSERID
WHERE R.RECIPE_ID = :recipe_id;
```

## âœ” 2) ì´ë¯¸ì§€ ì¡°íšŒ

```sql
SELECT RURL FROM recipes_img WHERE RECIPE_ID = :recipe_id;
```

## âœ” 3) ì¬ë£Œ ì¡°íšŒ

```sql
SELECT ING.INGRE_NAME, ING.INGRE_NUM
FROM recipes_ingre_map MAP
JOIN recipes_ingre ING
    ON MAP.INGRE_MAP_ID = ING.INGRE_MAP_ID
WHERE MAP.RECIPE_ID = :recipe_id;
```

---

## âœ” 4) ì „ì²´ ë ˆì‹œí”¼ ëª©ë¡ (ìµœì‹ ìˆœ)

```sql
SELECT 
    R.RECIPE_ID, R.TITLE, R.CATEGORY, R.IMAGE,
    R.CREATED_AT, R.UPDATED_AT, R.VIEWS,
    U.NICKNAME
FROM recipes R
JOIN BUG U ON R.APPUSERID = U.APPUSERID
ORDER BY GREATEST(R.CREATED_AT, NVL(R.UPDATED_AT, R.CREATED_AT)) DESC;
```

---

## âœ” 5) í˜ì´ì§•

```sql
SELECT *
FROM (
    SELECT 
        ROW_NUMBER() OVER (
            ORDER BY GREATEST(R.CREATED_AT, NVL(R.UPDATED_AT, R.CREATED_AT)) DESC
        ) AS RNUM,
        R.RECIPE_ID, R.TITLE, R.IMAGE, R.CATEGORY,
        R.CREATED_AT, R.UPDATED_AT, R.VIEWS,
        U.NICKNAME
    FROM recipes R
    JOIN BUG U ON R.APPUSERID = U.APPUSERID
) A
WHERE A.RNUM BETWEEN :start AND :end;
```

---

# ğŸ“Œ **UPDATE**

## âœ” ë ˆì‹œí”¼ ìˆ˜ì •

```sql
UPDATE recipes
SET 
    TITLE = :title,
    CATEGORY = :category,
    IMAGE = NVL(:image, 'user.png'),
    COOK_TIME = :cook_time,
    DIFFICULTY = :difficulty,
    SERVINGS = :servings,
    DESCRIPTION = :description,
    INSTRUCTIONS = :instructions,
    UPDATED_AT = CURRENT_TIMESTAMP
WHERE RECIPE_ID = :recipe_id;
```

---

## âœ” ì¡°íšŒìˆ˜ ì¦ê°€

```sql
UPDATE recipes
SET VIEWS = VIEWS + 1
WHERE RECIPE_ID = :recipe_id;
```

---

# ğŸ“Œ **DELETE**

(ìˆœì„œ ì¤‘ìš”)

```sql
DELETE FROM recipes_img WHERE RECIPE_ID = :recipe_id;

DELETE FROM recipes_ingre 
WHERE INGRE_MAP_ID IN (
    SELECT INGRE_MAP_ID FROM recipes_ingre_map WHERE RECIPE_ID = :recipe_id
);

DELETE FROM recipes_ingre_map WHERE RECIPE_ID = :recipe_id;

DELETE FROM recipes WHERE RECIPE_ID = :recipe_id;
```

---






~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~



--- ê¸¸ìƒí˜„ ìš”ë¦¬íŒŒíŠ¸
CREATE TABLE recipes (
    RECIPE_ID NUMBER PRIMARY KEY,
    APPUSERID  NUMBER,
    TITLE    VARCHAR2(255) NOT NULL,
    CATEGORY number(10),   -- ì „ì²´, í•œì‹, ì–‘ì‹, ì¤‘ì‹
    IMAGE VARCHAR2(255) DEFAULT 'user.png',   --  ëŒ€í‘œì´ë¯¸ì§€ 
    COOK_TIME NUMBER DEFAULT 0,
    DIFFICULTY VARCHAR2(50),
    SERVINGS NUMBER DEFAULT 1,
    DESCRIPTION VARCHAR2(4000),
    INSTRUCTIONS VARCHAR2(4000),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,  -- ìƒì„±ì¼
    UPDATED_AT TIMESTAMP,                           -- ìˆ˜ì •ì¼ (NULLì´ ê¸°ë³¸)
    VIEWS NUMBER DEFAULT 0,
    FOREIGN KEY (APPUSERID)  REFERENCES APPUSER(APPUSERID)
);

create table recipes_img ë¡œ í•˜ë‚˜ ë”°ë¡œ ë§Œë“¤ê±°ì•¼ ì—¬ëŸ¬ê°œ ì…ë ¥ë°›ì„ìˆ˜ìˆê²Œ


create table CATEGORY (
   CATEGORY number
   CATEGORY_name varchar2
)


CREATE TABLE recipes_ingre_map (
    RECIPE_ID NUMBER,
    ingre_map_id number
)


CREATE TABLE recipes_ingre (
    RECIPE_ID NUMBER,
    ingre_name varchar2(100),
    ingre_num number 
)


...................................................
-- 3. ë ˆì‹œí”¼ ì¶”ê°€ (INSERT)
> ìµœëŒ€ë ˆì‹œí”¼ë²ˆí˜¸ 
select max(RECIPE_ID)+1 from recipes 
 

> ë ˆì‹œí”¼ë“±ë¡
INSERT INTO recipes (
    RECIPE_ID,       APPUSERID  ,   TITLE,    CATEGORY,    IMAGE,  COOK_TIME,     DIFFICULTY
    ,SERVINGS,  DESCRIPTION,      INSTRUCTIONS 
) 
VALUES (
    recipes_id,   APPUSERID ,   title,  category,  NVL(:image, 'user.png'),  cook_time,  difficulty, 
    servings,  description,  instructions 
);
1  1  'ë¹„ë¹”ë°¥' 2(í•œì‹) 'user1.png' 3 'ì‰¬ì›€'  2'í•œêµ­ì˜ ì •ì·¨ë¥¼ ëŠë‚„ìˆ˜ ìˆëŠ” ìŒì‹' 'ì–‘íŒŒ 2ê°œ ê³„ë€ 2ê°œ'   'ë°©ë²•1. ë°©ë²•2. ë°©ë²•3. '   

> ì¬ë£Œì €ì¥í…Œì´ë¸”
insert into recipes_ing values (1 , 'ì–‘íŒŒ', '2ê°œ');
insert into recipes_ing values (1 , 'ê³„ë€', '2ê°œ');  -- ìµœëŒ€ë ˆì‹œí”¼ë²ˆí˜¸

1   ì–‘íŒŒ  2ê°œ
1   ê³„ë€  2ê°œ
2   ì–‘íŒŒ  2ê°œ
2   ê³„ë€  2ê°œ

> ê¸°ì¡´í…Œì´ë¸”ì—ì„œ   ì–‘íŒŒ, ê³„ë€,,, ì´ ìˆëŠ”ì§€ í™•ì¸
> ì¬ë£Œë§Œ ì…ë ¥


---- ì‹œê°„ë˜ë©´ upgrade 
--- ì¶”ê°€ì´ë¯¸ì§€) images
create table  images(
   RECIPE_ID  NUMBER ,
   iurl           varchar2(250) 
) 
â€» ìœ ì €ëŠ”  ì—¬ëŸ¬ê°œì˜ ë ˆì‹œí”¼ë¥¼ ì‘ì„±í• ìˆ˜ ìˆë‹¤.
â€» imagesëŠ” ë ˆì‹œí”¼ì˜ ì—¬ëŸ¬ê°œì˜ ì´ë¯¸ì§€ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.
1      'r001.png'
1      'r002.png'
1      'r003.png'




2-2) read [ë¡œê·¸ì¸,ë§ˆì´í˜ì´ì§€  ,ì•„ì´ë””ì°¾ê¸°/ë¹„ë°€ë²ˆí˜¸ì°¾ê¸°/ ì „ì²´ìœ ì €ì •ë³´í™•ì¸]
...................................................
-- 1. ë ˆì‹œí”¼ í•œ ê°œ ì¡°íšŒ (SELECT)
SELECT *  FROM  recipes   WHERE   RECIPE_ID = 1 

-- 2. ì‘ì„±í•œìœ ì € ì¡°íšŒ (SELECT)   ####
SELECT *  FROM  recipes   WHERE   RECIPE_ID = 1 (# ì‘ì„±í•œìœ ì € sql )

> í˜ì´ì§•ì´ìš©í•´ì„œ ëª‡ê°œ? 

-- 3. ëª¨ë“  ë ˆì‹œí”¼ ì¡°íšŒ (SELECTALL)  ####
SELECT *
FROM recipes
ORDER BY GREATEST(CREATED_AT, NVL(UPDATED_AT, CREATED_AT)) DESC;

> í˜ì´ì§•ì´ìš©í•´ì„œ ëª‡ê°œ
     select  *
     from  (
         select     row_number()   over (  order by  created_at desc )  as  rnum , 
         id  , app_user_id , btitle, bcontent, bpass, bfile,  bip , bhit, created_at
         from sboard1
      )  A
   where   A.rnum  between  #{start}   and #{end}



...................................................
-- 2-3. ë ˆì‹œí”¼ ìˆ˜ì • (UPDATE)
UPDATE recipes
SET 
    TITLE = :title,
    CATEGORY = :category,
    IMAGE = NVL(:image, 'user.png'),
    COOK_TIME = :cook_time,
    DIFFICULTY = :difficulty,
    SERVINGS = :servings,
    DESCRIPTION = :description, 
    INSTRUCTIONS = :instructions,
    UPDATED_AT = CURRENT_TIMESTAMP
WHERE 
    RECIPE_ID = 1


--   ì¡°íšŒìˆ˜ ì¦ê°€ (VIEW + 1)
UPDATE recipes
SET 
    VIEWS = VIEWS + 1
WHERE 
    RECIPE_ID = 1


...................................................
-- 2-4. ë ˆì‹œí”¼ ì‚­ì œ (DELETE)
DELETE FROM recipes
WHERE 
    RECIPE_ID = 1

 